{{ header }}{{ column_left }} 
<div id="content">
  <!-- The Modal -->
  <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
          <span class="close">&times;</span>
          <div id="popup_content"><img src="" style="margin-left: 6em; width: 50%;"><h2>Loading.......</h2></div>
      </div>
  </div> 
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %} 
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %} 
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if (error_warning) %} 
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    {% if (success) %} 
    <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i> {{ text_list }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-product" class="form-horizontal">
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-tax-class">{{ entry_segments }}</label>
            <div class="col-sm-10">
              <select name="segments" id="input-segments" class="form-control">
                <option value="0">{{ text_none }}</option>
                {% for segment in segments %}
                  <option value="{{ segment.code }}?segment={{ segment.name }}">{{ segment.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-tom-id">{{ entry_tom_id }}</label>
            <div class="col-sm-10">
              <input type="text" name="tom_id" placeholder="{{ entry_tom_id }}" id="input-tom-id" class="form-control"/>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-manufacturer"><span data-toggle="tooltip" title="{{ help_manufacturer }}">{{ entry_manufacturer }}</span></label>
            <div class="col-sm-10">
              <input type="text" name="manufacturer" value="{{ manufacturer }}" placeholder="{{ entry_manufacturer }}" id="input-manufacturer" class="form-control"/> <input type="hidden" name="manufacturer_id" value="{{ manufacturer_id }}"/>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="{{ help_category }}">{{ entry_category }}</span></label>
            <div class="col-sm-10">
              <input type="text" name="category" value="" placeholder="{{ entry_category }}" id="input-category" class="form-control"/>
              <div id="product-category" class="well well-sm" style="height: 150px; overflow: auto;"> {% for product_category in product_categories %}
                  <div id="product-category{{ product_category.category_id }}"><i class="fa fa-minus-circle"></i> {{ product_category.name }}
                    <input type="hidden" name="product_category[]" value="{{ product_category.category_id }}"/>
                  </div>
                {% endfor %}</div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">{{ entry_store }}</label>
            <div class="col-sm-10">
              <div class="well well-sm" style="height: 150px; overflow: auto;"> {% for store in stores %}
                  <div class="checkbox">
                    <label> {% if store.store_id in product_store %}
                        <input type="checkbox" name="product_store[]" value="{{ store.store_id }}" checked="checked"/>
                        {{ store.name }}
                      {% else %}
                        <input type="checkbox" name="product_store[]" value="{{ store.store_id }}"/>
                        {{ store.name }}
                      {% endif %} </label>
                  </div>
                {% endfor %}</div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-tax-class">{{ entry_tax_class }}</label>
            <div class="col-sm-10">
              <select name="tax_class_id" id="input-tax-class" class="form-control">
                <option value="0">{{ text_none }}</option>
                {% for tax_class in tax_classes %}
                  {% if tax_class.tax_class_id == tax_class_id %}
                    <option value="{{ tax_class.tax_class_id }}" selected="selected">{{ tax_class.title }}</option>
                  {% else %}
                    <option value="{{ tax_class.tax_class_id }}">{{ tax_class.title }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-minimum"><span data-toggle="tooltip" title="{{ help_minimum }}">{{ entry_minimum }}</span></label>
            <div class="col-sm-10">
              <input type="text" name="minimum" value="{{ minimum }}" placeholder="{{ entry_minimum }}" id="input-minimum" class="form-control"/>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-subtract">{{ entry_subtract }}</label>
            <div class="col-sm-10">
              <select name="subtract" id="input-subtract" class="form-control">
                {% if subtract %}
                  <option value="1" selected="selected">{{ text_yes }}</option>
                  <option value="0">{{ text_no }}</option>
                {% else %}
                  <option value="1">{{ text_yes }}</option>
                  <option value="0" selected="selected">{{ text_no }}</option>
                {% endif %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-stock-status"><span data-toggle="tooltip" title="{{ help_stock_status }}">{{ entry_stock_status }}</span></label>
            <div class="col-sm-10">
              <select name="stock_status_id" id="input-stock-status" class="form-control">
                {% for stock_status in stock_statuses %}
                  {% if stock_status.stock_status_id == stock_status_id %}
                    <option value="{{ stock_status.stock_status_id }}" selected="selected">{{ stock_status.name }}</option>
                  {% else %}
                    <option value="{{ stock_status.stock_status_id }}">{{ stock_status.name }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">{{ entry_shipping }}</label>
            <div class="col-sm-10">
              <label class="radio-inline"> {% if shipping %}
                  <input type="radio" name="shipping" value="1" checked="checked"/>
                  {{ text_yes }}
                {% else %}
                  <input type="radio" name="shipping" value="1"/>
                  {{ text_yes }}
                {% endif %} </label> <label class="radio-inline"> {% if not shipping %}
                  <input type="radio" name="shipping" value="0" checked="checked"/>
                  {{ text_no }}
                {% else %}
                  <input type="radio" name="shipping" value="0"/>
                  {{ text_no }}
                {% endif %} </label>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-date-available">{{ entry_date_available }}</label>
            <div class="col-sm-3">
              <div class="input-group date">
                <input type="text" name="date_available" value="{{ date_available }}" placeholder="{{ entry_date_available }}" data-date-format="YYYY-MM-DD" id="input-date-available" class="form-control"/> <span class="input-group-btn">
                <button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
                </span></div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
            <div class="col-sm-10">
              <select name="status" id="input-status" class="form-control">
                {% if status %}
                  <option value="1" selected="selected">{{ text_enabled }}</option>
                  <option value="0">{{ text_disabled }}</option>
                {% else %}
                  <option value="1">{{ text_enabled }}</option>
                  <option value="0" selected="selected">{{ text_disabled }}</option>
                {% endif %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-length-class">{{ entry_length_class }}</label>
            <div class="col-sm-10">
              <select name="length_class_id" id="input-length-class" class="form-control">
                {% for length_class in length_classes %}
                  {% if length_class.length_class_id == length_class_id %}
                    <option value="{{ length_class.length_class_id }}" selected="selected">{{ length_class.title }}</option>
                  {% else %}
                    <option value="{{ length_class.length_class_id }}">{{ length_class.title }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-weight-class">{{ entry_weight_class }}</label>
            <div class="col-sm-10">
              <select name="weight_class_id" id="input-weight-class" class="form-control">
                {% for weight_class in weight_classes %}
                  {% if weight_class.weight_class_id == weight_class_id %}
                    <option value="{{ weight_class.weight_class_id }}" selected="selected">{{ weight_class.title }}</option>
                  {% else %}
                    <option value="{{ weight_class.weight_class_id }}">{{ weight_class.title }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-2"></label>
            <div class="col-md-2">
              <input type="button" onclick="getImportData();" form="form-product" data-toggle="tooltip" value="{{ button_import_by_segment }}" title="{{ button_import_by_segment }}" class="btn btn-primary form-control">
            </div>
            <div class="col-md-2">
              <input type="submit" form="form-product" data-toggle="tooltip" value="{{ button_import_by_id }}" title="{{ button_import_by_id }}" class="btn btn-primary form-control">
              <div class="ajax_message"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
<script type="text/javascript"><!--
// Manufacturer
  $('input[name=\'manufacturer\']').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=catalog/manufacturer/autocomplete&{{ session_token_key }}={{ session_token }}&filter_name=' + encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          json.unshift({
            manufacturer_id: 0,
            name: '{{ text_none }}'
          });

          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['manufacturer_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name=\'manufacturer\']').val(item['label']);
      $('input[name=\'manufacturer_id\']').val(item['value']);
    }
  });

  // Category
  $('input[name=\'category\']').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=catalog/category/autocomplete&{{ session_token_key }}={{ session_token }}&filter_name=' + encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['category_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name=\'category\']').val('');

      $('#product-category' + item['value']).remove();

      $('#product-category').append('<div id="product-category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_category[]" value="' + item['value'] + '" /></div>');
    }
  });

  $('#product-category').delegate('.fa-minus-circle', 'click', function() {
    $(this).parent().remove();
  });
</script>
<script type="text/javascript"><!--
  $('.date').datetimepicker({
    language: '{{ datepicker }}',
    pickTime: false
  });

  $('.time').datetimepicker({
    language: '{{ datepicker }}',
    pickDate: false
  });

  $('.datetime').datetimepicker({
    language: '{{ datepicker }}',
    pickDate: true,
    pickTime: true
  });
  //--></script>
<script type="text/javascript">
function getImportData() {
  var page = 1;
  var last_page = 1;
  importProduct(page);
}

function importProduct(page) {  
  $.ajax({
      url: 'index.php?route=extension/module/cedtom/product/importProductBySegment&{{ session_token_key }}={{ session_token }}&page='+page,
      type: 'post',
      data: $('input[type=\'text\'], input[type=\'hidden\'], input[type=\'checkbox\']:checked, input[type=\'radio\']:checked, textarea, select'),
      dataType: 'json',
      beforeSend: function() {
        modal.style.display = "block";
      },
      success: function(json) {
          console.log(json);
          if(json.current_page){
            page = json.current_page+1;
            last_page = json.last_page;
          }else{
            page = 0;
            last_page = 0;
          }

          if(page > 0 && page <= last_page) {
            html = page+" of "+last_page+ " page is in Processing...";
            $('#popup_content h2').html(html);
            importProduct(page);
          }else{
            modal.style.display = "none";
            html = "Process Completed.";
            alert(html);
            location.reload();
          }
      },
      error: function(xhr, ajaxOptions, thrownError) {
          alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
  });
}
</script>
<style type="text/css">
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 999; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0, 0, 0); /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 20%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>
<script type="text/javascript">
    var modal = document.getElementById('myModal');
    var span = document.getElementsByClassName("close")[0];
    span.onclick = function () {
        modal.style.display = "none";
    }
</script>
</div>
{{ footer }}